# Authentication Integration Visual Flow

## ğŸ¯ Complete Authentication Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                            â”‚
â”‚                           USER INTERFACE LAYER                             â”‚
â”‚                                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚  SignInPage.tsx  â”‚              â”‚  SignUpPage.tsx  â”‚                  â”‚
â”‚  â”‚                  â”‚              â”‚                  â”‚                  â”‚
â”‚  â”‚  â€¢ Email/Pass    â”‚              â”‚  â€¢ Email/Pass    â”‚                  â”‚
â”‚  â”‚  â€¢ Google Login  â”‚              â”‚  â€¢ Google Signup â”‚                  â”‚
â”‚  â”‚  â€¢ Form UI       â”‚              â”‚  â€¢ Form UI       â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚           â”‚                                 â”‚                             â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚                        â”‚                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                            â”‚
â”‚                        AUTHENTICATION CONTEXT                              â”‚
â”‚                         (AuthContext.tsx)                                  â”‚
â”‚                                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  const { signIn, signUp, signOut, currentUser, loading }        â”‚    â”‚
â”‚  â”‚                                                                   â”‚    â”‚
â”‚  â”‚  â€¢ Global auth state management                                  â”‚    â”‚
â”‚  â”‚  â€¢ Listen to Firebase auth changes                              â”‚    â”‚
â”‚  â”‚  â€¢ Auto-sync with backend on sign-in                            â”‚    â”‚
â”‚  â”‚  â€¢ Provide auth methods to entire app                           â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚                       â”‚
                         â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                        â”‚  â”‚                              â”‚
â”‚       FIREBASE AUTHENTICATION          â”‚  â”‚     AUTH SERVICE             â”‚
â”‚         (lib/firebase.ts)              â”‚  â”‚  (authService.ts)            â”‚
â”‚                                        â”‚  â”‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  signInWithGoogle()            â”‚   â”‚  â”‚  â”‚  syncUserWithBackendâ”‚    â”‚
â”‚  â”‚  signInWithEmail()             â”‚   â”‚  â”‚  â”‚  signOutBackend()   â”‚    â”‚
â”‚  â”‚  signUpWithEmail()             â”‚   â”‚  â”‚  â”‚  verifySession()    â”‚    â”‚
â”‚  â”‚  signOutUser()                 â”‚   â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚             â”‚                â”‚
â”‚                                        â”‚  â”‚             â”‚                â”‚
â”‚  â€¢ Handles Firebase operations        â”‚  â”‚  â€¢ Bridge to backend        â”‚
â”‚  â€¢ Returns Firebase user object       â”‚  â”‚  â€¢ Sends ID tokens          â”‚
â”‚  â€¢ Stores in Firestore                â”‚  â”‚  â€¢ Manages sessions         â”‚
â”‚                                        â”‚  â”‚                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚                                          â”‚
                 â”‚  Firebase User Object                   â”‚  HTTP Request
                 â”‚  + ID Token                             â”‚  (Bearer Token)
                 â”‚                                          â”‚
                 â–¼                                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                            â”‚
â”‚                              FIREBASE CLOUD                                â”‚
â”‚                                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚  â”‚  Authentication  â”‚        â”‚    Firestore     â”‚                        â”‚
â”‚  â”‚                  â”‚        â”‚                  â”‚                        â”‚
â”‚  â”‚  â€¢ User accounts â”‚        â”‚  â€¢ User profiles â”‚                        â”‚
â”‚  â”‚  â€¢ ID tokens     â”‚        â”‚  â€¢ User roles    â”‚                        â”‚
â”‚  â”‚  â€¢ Sessions      â”‚        â”‚  â€¢ Additional    â”‚                        â”‚
â”‚  â”‚  â€¢ Security      â”‚        â”‚    user data     â”‚                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          
                                     â†“ HTTP POST /api/auth/sync
                                     â†“ Authorization: Bearer <token>
                                     
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                            â”‚
â”‚                          BACKEND API LAYER                                 â”‚
â”‚                            (Node.js/Express)                               â”‚
â”‚                                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                      apiRoutes.js (Main Router)                  â”‚    â”‚
â”‚  â”‚                                                                   â”‚    â”‚
â”‚  â”‚  router.use('/auth', frontendAuthRoutes)      â† NEW!            â”‚    â”‚
â”‚  â”‚  router.use('/properties', propertyRoutes)    â† SEPARATED       â”‚    â”‚
â”‚  â”‚  router.use('/admin/users', userRoutes)       â† SEPARATED       â”‚    â”‚
â”‚  â”‚  router.use('/admin/bookings', bookingRoutes) â† SEPARATED       â”‚    â”‚
â”‚  â”‚  router.use('/admin/dashboard', dashboardRoutes) â† SEPARATED    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                            â”‚
â”‚                     FRONTEND AUTH ROUTES                                   â”‚
â”‚                  (frontendAuthRoutes.js)                                   â”‚
â”‚                                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                                                                   â”‚    â”‚
â”‚  â”‚  1. verifyFirebaseToken(req, res, next)                         â”‚    â”‚
â”‚  â”‚     â”œâ”€ Extract Bearer token from Authorization header           â”‚    â”‚
â”‚  â”‚     â”œâ”€ Verify with Firebase Admin SDK                           â”‚    â”‚
â”‚  â”‚     â””â”€ Decode user info (uid, email, etc.)                      â”‚    â”‚
â”‚  â”‚                                                                   â”‚    â”‚
â”‚  â”‚  2. POST /api/auth/sync                                          â”‚    â”‚
â”‚  â”‚     â”œâ”€ Find user by firebaseUid                                 â”‚    â”‚
â”‚  â”‚     â”œâ”€ Create if doesn't exist                                  â”‚    â”‚
â”‚  â”‚     â”œâ”€ Update user info if exists                               â”‚    â”‚
â”‚  â”‚     â””â”€ Create Express session                                   â”‚    â”‚
â”‚  â”‚                                                                   â”‚    â”‚
â”‚  â”‚  3. POST /api/auth/register                                      â”‚    â”‚
â”‚  â”‚     â”œâ”€ Create new user in MongoDB                               â”‚    â”‚
â”‚  â”‚     â””â”€ Establish session                                         â”‚    â”‚
â”‚  â”‚                                                                   â”‚    â”‚
â”‚  â”‚  4. GET /api/auth/verify                                         â”‚    â”‚
â”‚  â”‚     â””â”€ Check session validity                                    â”‚    â”‚
â”‚  â”‚                                                                   â”‚    â”‚
â”‚  â”‚  5. POST /api/auth/logout                                        â”‚    â”‚
â”‚  â”‚     â””â”€ Destroy Express session                                   â”‚    â”‚
â”‚  â”‚                                                                   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                            â”‚
â”‚                          FIREBASE ADMIN SDK                                â”‚
â”‚                          (Token Verification)                              â”‚
â”‚                                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  const admin = require('firebase-admin');                        â”‚    â”‚
â”‚  â”‚                                                                   â”‚    â”‚
â”‚  â”‚  admin.auth().verifyIdToken(token)                              â”‚    â”‚
â”‚  â”‚    â”œâ”€ Cryptographically verifies signature                      â”‚    â”‚
â”‚  â”‚    â”œâ”€ Checks expiration (1 hour)                                â”‚    â”‚
â”‚  â”‚    â”œâ”€ Validates issuer and audience                             â”‚    â”‚
â”‚  â”‚    â””â”€ Returns decoded user data                                 â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                            â”‚
â”‚                         MONGODB DATABASE                                   â”‚
â”‚                                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚                     Users Collection                        â”‚          â”‚
â”‚  â”‚                                                             â”‚          â”‚
â”‚  â”‚  {                                                          â”‚          â”‚
â”‚  â”‚    _id: ObjectId("..."),                                   â”‚          â”‚
â”‚  â”‚    firebaseUid: "abc123...",    â† Links to Firebase       â”‚          â”‚
â”‚  â”‚    email: "user@example.com",                              â”‚          â”‚
â”‚  â”‚    displayName: "John Doe",                                â”‚          â”‚
â”‚  â”‚    photoURL: "https://...",                                â”‚          â”‚
â”‚  â”‚    role: "user",                â† user | owner | admin     â”‚          â”‚
â”‚  â”‚    createdAt: ISODate(...),                                â”‚          â”‚
â”‚  â”‚    updatedAt: ISODate(...)                                 â”‚          â”‚
â”‚  â”‚  }                                                          â”‚          â”‚
â”‚  â”‚                                                             â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚                   Sessions Collection                       â”‚          â”‚
â”‚  â”‚                                                             â”‚          â”‚
â”‚  â”‚  {                                                          â”‚          â”‚
â”‚  â”‚    _id: "session-id",                                      â”‚          â”‚
â”‚  â”‚    session: {                                              â”‚          â”‚
â”‚  â”‚      userId: ObjectId("..."),                              â”‚          â”‚
â”‚  â”‚      userEmail: "user@example.com",                        â”‚          â”‚
â”‚  â”‚      userName: "John Doe",                                 â”‚          â”‚
â”‚  â”‚      firebaseUid: "abc123..."   â† Session linked!         â”‚          â”‚
â”‚  â”‚    },                                                       â”‚          â”‚
â”‚  â”‚    expires: ISODate(...)                                   â”‚          â”‚
â”‚  â”‚  }                                                          â”‚          â”‚
â”‚  â”‚                                                             â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š Route Organization Chart

```
admin-console/routes/
â”‚
â”œâ”€â”€ apiRoutes.js (28 lines) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” Main Router
â”‚   â”‚                                    â”‚ Aggregates all routes
â”‚   â”œâ”€â–º /api/auth â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â–º frontendAuthRoutes.js
â”‚   â”œâ”€â–º /api/properties â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â–º propertyRoutes.js
â”‚   â”œâ”€â–º /api/admin/properties â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â–º propertyRoutes.js
â”‚   â”œâ”€â–º /api/admin/users â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â–º userRoutes.js
â”‚   â”œâ”€â–º /api/admin/bookings â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â–º bookingRoutes.js
â”‚   â””â”€â–º /api/admin/dashboard â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â–º dashboardRoutes.js
â”‚                                        â”‚
â”œâ”€â”€ frontendAuthRoutes.js (295 lines) â”€â”€â”¤ NEW! Firebase Integration
â”‚   â”œâ”€â–º POST /register                  â”‚ Create user from Firebase
â”‚   â”œâ”€â–º POST /sync                      â”‚ Sync/login Firebase user
â”‚   â”œâ”€â–º GET /verify                     â”‚ Verify session
â”‚   â”œâ”€â–º GET /me                         â”‚ Get current user
â”‚   â”œâ”€â–º POST /logout                    â”‚ Destroy session
â”‚   â””â”€â–º PUT /profile                    â”‚ Update profile
â”‚                                        â”‚
â”œâ”€â”€ propertyRoutes.js (437 lines) â”€â”€â”€â”€â”€â”€â”¤ Property CRUD
â”‚   â”œâ”€â–º GET /                           â”‚ List all
â”‚   â”œâ”€â–º GET /public                     â”‚ Public list
â”‚   â”œâ”€â–º GET /public/:id                 â”‚ Public detail
â”‚   â”œâ”€â–º GET /admin                      â”‚ Admin list
â”‚   â”œâ”€â–º GET /admin/:id                  â”‚ Admin detail
â”‚   â”œâ”€â–º POST /admin                     â”‚ Create
â”‚   â”œâ”€â–º PUT /admin/:id                  â”‚ Update
â”‚   â””â”€â–º DELETE /admin/:id               â”‚ Delete
â”‚                                        â”‚
â”œâ”€â”€ userRoutes.js (108 lines) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ User Management
â”‚   â”œâ”€â–º GET /                           â”‚ List users
â”‚   â”œâ”€â–º GET /:id                        â”‚ Get user
â”‚   â””â”€â–º DELETE /:id                     â”‚ Delete user
â”‚                                        â”‚
â”œâ”€â”€ bookingRoutes.js (147 lines) â”€â”€â”€â”€â”€â”€â”€â”¤ Booking Management
â”‚   â”œâ”€â–º GET /                           â”‚ List bookings
â”‚   â”œâ”€â–º GET /:id                        â”‚ Get booking
â”‚   â”œâ”€â–º PATCH /:id/status               â”‚ Update status
â”‚   â””â”€â–º DELETE /:id                     â”‚ Delete booking
â”‚                                        â”‚
â”œâ”€â”€ dashboardRoutes.js (82 lines) â”€â”€â”€â”€â”€â”€â”¤ Dashboard Stats
â”‚   â”œâ”€â–º GET /stats                      â”‚ Get statistics
â”‚   â””â”€â–º GET /recent-bookings            â”‚ Recent bookings
â”‚                                        â”‚
â”œâ”€â”€ authRoutes.js (15 lines) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ Admin Console Auth
â”‚   â”œâ”€â–º GET /login                      â”‚ Login page
â”‚   â”œâ”€â–º POST /login                     â”‚ Login submit
â”‚   â””â”€â–º GET /logout                     â”‚ Logout
â”‚                                        â”‚
â””â”€â”€ adminRoutes.js (65 lines) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ Admin Console Views
    â””â”€â–º EJS template routes
```

## ğŸ”„ Complete Sign-In Flow (Step by Step)

```
Step 1: User enters email/password
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   SignInPage.tsx       â”‚
â”‚   [Email: ___________] â”‚
â”‚   [Pass:  ___________] â”‚
â”‚   [ Sign In Button   ] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚ onClick
            â–¼
Step 2: Call signIn from context
            â”‚
   const { signIn } = useAuth()
   await signIn(email, password)
            â”‚
            â–¼
Step 3: Firebase authentication
            â”‚
   signInWithEmail(email, password)
            â”‚
            â–¼
Step 4: Firebase returns user + token
            â”‚
   { uid, email, displayName, photoURL }
   + ID Token (JWT, valid 1 hour)
            â”‚
            â–¼
Step 5: AuthContext detects auth change
            â”‚
   onAuthStateChanged((user) => {
     setCurrentUser(user)
            â”‚
            â–¼
Step 6: Auto-sync with backend
            â”‚
   authService.syncUserWithBackend(user)
            â”‚
            â–¼
Step 7: Send to backend
            â”‚
   POST /api/auth/sync
   Headers: { Authorization: "Bearer <token>" }
   Body: { firebaseUid, email, displayName, photoURL }
            â”‚
            â–¼
Step 8: Backend verifies token
            â”‚
   verifyFirebaseToken middleware
   admin.auth().verifyIdToken(token)
            â”‚
            â–¼
Step 9: Find/create user in MongoDB
            â”‚
   User.findOne({ firebaseUid })
   or
   new User({ firebaseUid, email, ... }).save()
            â”‚
            â–¼
Step 10: Create Express session
            â”‚
   req.session.userId = user._id
   req.session.firebaseUid = firebaseUid
            â”‚
            â–¼
Step 11: Return success
            â”‚
   res.json({ success: true, user: {...} })
            â”‚
            â–¼
Step 12: Redirect to dashboard
            â”‚
   navigate('/dashboard')
            â”‚
            â–¼
Step 13: User is now authenticated!
            â”‚
   âœ… Firebase: Authenticated
   âœ… Firestore: User profile stored
   âœ… MongoDB: User record created
   âœ… Express: Session established
   âœ… Frontend: Can access protected routes
   âœ… Backend: Can access API endpoints
```

## ğŸ¯ Key Integration Points

### 1. Token Flow
```
Firebase Auth â†’ ID Token â†’ Backend API â†’ Verify â†’ Session
```

### 2. User Data Flow
```
Firebase User â†’ AuthContext â†’ authService â†’ Backend â†’ MongoDB
```

### 3. Session Flow
```
MongoDB User â†’ Express Session â†’ Stored in MongoDB â†’ Linked to Firebase UID
```

This visual guide shows exactly how the frontend authentication pages connect to the backend routes in a clean, professional manner! ğŸš€

