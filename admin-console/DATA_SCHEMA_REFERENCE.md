# MongoDB Data Schema Reference

## Complete Schema Documentation for Admin Console

This document provides a comprehensive overview of all MongoDB collections and their schemas used in the admin console.

---

## Collections Overview

The admin console uses **4 MongoDB collections**:

1. **admins** - Admin user accounts (authentication)
2. **rentals** - Property/rental listings
3. **users** - Platform users (customers)
4. **bookings** - Property reservations

---

## 1. Admins Collection

**Purpose**: Store admin user accounts for console authentication

### Schema:

```javascript
{
  _id: ObjectId,              // Auto-generated by MongoDB
  name: String,               // Admin's full name
  email: String,              // Email (unique, used for login)
  password: String,           // Hashed password (bcrypt)
  createdAt: Date            // Account creation timestamp
}
```

### Indexes:
- `email`: Unique index for fast login queries

### Validation:
- ‚úÖ email: Required, unique, lowercase, valid email format
- ‚úÖ password: Required, minimum 6 characters (hashed before storage)
- ‚úÖ name: Required

### Example Document:
```json
{
  "_id": "507f1f77bcf86cd799439011",
  "name": "John Doe",
  "email": "admin@example.com",
  "password": "$2a$10$...", 
  "createdAt": "2024-01-15T10:30:00.000Z"
}
```

---

## 2. Rentals Collection

**Purpose**: Store rental property listings with details and images

### Schema:

```javascript
{
  _id: ObjectId,              // Auto-generated by MongoDB
  title: String,              // Property title/name
  description: String,        // Full property description
  location: String,           // City/area name
  address: String,            // Full street address
  price: Number,              // Price per night (in dollars)
  bedrooms: Number,           // Number of bedrooms
  bathrooms: Number,          // Number of bathrooms
  amenities: [String],        // Array of amenity names
  images: [String],           // Array of image paths (/uploads/rentals/...)
  ownerName: String,          // Property owner's name
  ownerEmail: String,         // Property owner's email
  ownerPhone: String,         // Property owner's phone
  availability: Boolean,      // Is property available for booking?
  createdAt: Date,           // Property creation date
  updatedAt: Date            // Last update date
}
```

### Indexes:
- `location`: Index for location-based searches
- `availability`: Index for filtering available properties
- `price`: Index for price range queries

### Validation:
- ‚úÖ title: Required, trimmed
- ‚úÖ description: Required
- ‚úÖ location: Required, trimmed
- ‚úÖ address: Required, trimmed
- ‚úÖ price: Required, number, minimum 0
- ‚úÖ bedrooms: Number, minimum 0, default 1
- ‚úÖ bathrooms: Number, minimum 0, default 1
- ‚úÖ amenities: Array of strings
- ‚úÖ images: Array of strings (local file paths)
- ‚úÖ availability: Boolean, default true

### Example Document:
```json
{
  "_id": "507f1f77bcf86cd799439012",
  "title": "Luxury 2BR Apartment in Downtown Cairo",
  "description": "Beautiful modern apartment with amazing city views...",
  "location": "Cairo",
  "address": "123 Tahrir Square, Cairo, Egypt",
  "price": 150,
  "bedrooms": 2,
  "bathrooms": 2,
  "amenities": ["WiFi", "Air Conditioning", "Kitchen", "Parking"],
  "images": [
    "/uploads/rentals/property-1234567890-123456789.jpg",
    "/uploads/rentals/property-1234567890-987654321.jpg"
  ],
  "ownerName": "Ahmed Hassan",
  "ownerEmail": "owner@example.com",
  "ownerPhone": "+20123456789",
  "availability": true,
  "createdAt": "2024-01-15T10:30:00.000Z",
  "updatedAt": "2024-01-20T14:22:00.000Z"
}
```

---

## 3. Users Collection

**Purpose**: Store platform users (customers who book properties)

### Schema:

```javascript
{
  _id: ObjectId,              // Auto-generated by MongoDB
  email: String,              // User's email (unique)
  displayName: String,        // User's display name
  phoneNumber: String,        // User's phone number
  role: String,               // User role: 'user', 'owner', or 'admin'
  createdAt: Date,           // Account creation date
  updatedAt: Date            // Last update date
}
```

### Indexes:
- `email`: Unique index
- `role`: Index for filtering by role

### Validation:
- ‚úÖ email: Required, unique, lowercase, trimmed
- ‚úÖ displayName: String, default empty
- ‚úÖ phoneNumber: String, default empty
- ‚úÖ role: Enum ['user', 'owner', 'admin'], default 'user'

### Example Document:
```json
{
  "_id": "507f1f77bcf86cd799439013",
  "email": "customer@example.com",
  "displayName": "Sarah Ahmed",
  "phoneNumber": "+20198765432",
  "role": "user",
  "createdAt": "2024-01-10T08:15:00.000Z",
  "updatedAt": "2024-01-10T08:15:00.000Z"
}
```

---

## 4. Bookings Collection

**Purpose**: Store property booking/reservation records

### Schema:

```javascript
{
  _id: ObjectId,              // Auto-generated by MongoDB
  propertyId: ObjectId,       // Reference to rentals collection
  userId: ObjectId,           // Reference to users collection
  checkIn: Date,              // Check-in date
  checkOut: Date,             // Check-out date
  guests: Number,             // Number of guests
  totalPrice: Number,         // Total booking price
  status: String,             // 'pending', 'confirmed', or 'cancelled'
  specialRequests: String,    // Customer's special requests
  cleaningService: Boolean,   // Extra cleaning service requested?
  airportPickup: Boolean,     // Airport pickup requested?
  earlyCheckIn: Boolean,      // Early check-in requested?
  createdAt: Date,           // Booking creation date
  updatedAt: Date            // Last update date
}
```

### Relationships:
- `propertyId` ‚Üí References `rentals._id`
- `userId` ‚Üí References `users._id`

### Indexes:
- `propertyId`: Index for property-based queries
- `userId`: Index for user-based queries
- `status`: Index for filtering by status
- `checkIn`: Index for date range queries

### Validation:
- ‚úÖ propertyId: Required, must be valid ObjectId
- ‚úÖ userId: Required, must be valid ObjectId
- ‚úÖ checkIn: Required, must be a date
- ‚úÖ checkOut: Required, must be after checkIn
- ‚úÖ guests: Number, minimum 1, default 1
- ‚úÖ totalPrice: Required, number, minimum 0
- ‚úÖ status: Enum ['pending', 'confirmed', 'cancelled'], default 'pending'
- ‚úÖ specialRequests: String, default empty
- ‚úÖ cleaningService: Boolean, default false
- ‚úÖ airportPickup: Boolean, default false
- ‚úÖ earlyCheckIn: Boolean, default false

### Example Document:
```json
{
  "_id": "507f1f77bcf86cd799439014",
  "propertyId": "507f1f77bcf86cd799439012",
  "userId": "507f1f77bcf86cd799439013",
  "checkIn": "2024-02-01T14:00:00.000Z",
  "checkOut": "2024-02-05T11:00:00.000Z",
  "guests": 2,
  "totalPrice": 600,
  "status": "confirmed",
  "specialRequests": "Please provide extra towels",
  "cleaningService": true,
  "airportPickup": false,
  "earlyCheckIn": true,
  "createdAt": "2024-01-20T09:30:00.000Z",
  "updatedAt": "2024-01-21T10:15:00.000Z"
}
```

---

## Additional Fields You Might Want to Add

Based on typical rental platforms, here are **recommended additional fields** you might want to consider:

### For Rentals:
```javascript
{
  // Existing fields...
  
  // Optional additions:
  propertyType: String,           // 'apartment', 'house', 'villa', etc.
  maxGuests: Number,              // Maximum number of guests allowed
  minimumStay: Number,            // Minimum nights required
  checkInTime: String,            // e.g., "14:00"
  checkOutTime: String,           // e.g., "11:00"
  cancellationPolicy: String,     // 'flexible', 'moderate', 'strict'
  securityDeposit: Number,        // Refundable security deposit amount
  cleaningFee: Number,            // One-time cleaning fee
  squareMeters: Number,           // Property size
  floor: Number,                  // Floor number (if apartment)
  hasElevator: Boolean,           // For accessibility
  petFriendly: Boolean,           // Pets allowed?
  smokingAllowed: Boolean,        // Smoking allowed?
  instantBook: Boolean,           // Allow instant booking without approval?
  coordinates: {                  // For map display
    latitude: Number,
    longitude: Number
  },
  rating: Number,                 // Average rating (0-5)
  reviewCount: Number,            // Total number of reviews
  viewCount: Number,              // Total page views
  bookingCount: Number            // Total successful bookings
}
```

### For Users:
```javascript
{
  // Existing fields...
  
  // Optional additions:
  profilePhoto: String,           // Profile image path
  bio: String,                    // User bio/description
  verifiedEmail: Boolean,         // Email verified?
  verifiedPhone: Boolean,         // Phone verified?
  preferredLanguage: String,      // 'en', 'ar', etc.
  dateOfBirth: Date,              // For age verification
  address: String,                // User's address
  city: String,                   // User's city
  country: String,                // User's country
  emergencyContact: {             // Emergency contact info
    name: String,
    phone: String
  },
  preferences: {                  // User preferences
    currency: String,             // 'USD', 'EGP', etc.
    notifications: Boolean,       // Email notifications enabled?
    newsletter: Boolean           // Subscribe to newsletter?
  },
  loyaltyPoints: Number,          // Loyalty/reward points
  totalBookings: Number,          // Total bookings made
  lastLogin: Date                 // Last login timestamp
}
```

### For Bookings:
```javascript
{
  // Existing fields...
  
  // Optional additions:
  confirmationCode: String,       // Unique confirmation code (e.g., "ABC123")
  paymentMethod: String,          // 'card', 'cash', 'transfer'
  paymentStatus: String,          // 'pending', 'paid', 'refunded'
  transactionId: String,          // Payment gateway transaction ID
  securityDeposit: Number,        // Security deposit amount charged
  cleaningFee: Number,            // Cleaning fee charged
  serviceFee: Number,             // Platform service fee
  discount: Number,               // Discount amount applied
  discountCode: String,           // Promo/discount code used
  numberOfNights: Number,         // Calculated: checkOut - checkIn
  pricePerNight: Number,          // Price per night at time of booking
  cancellationDate: Date,         // When booking was cancelled (if applicable)
  cancellationReason: String,     // Reason for cancellation
  reviewSubmitted: Boolean,       // Has guest reviewed the property?
  hostReviewSubmitted: Boolean,   // Has host reviewed the guest?
  checkInCompleted: Boolean,      // Guest has checked in?
  checkOutCompleted: Boolean,     // Guest has checked out?
  notes: String                   // Admin notes about the booking
}
```

---

## Current Implementation Status

### ‚úÖ Currently Implemented:

1. **Admins Collection** - ‚úÖ Complete
   - All essential fields present
   - Authentication working
   - Password hashing implemented

2. **Rentals Collection** - ‚úÖ Complete for MVP
   - Core property details ‚úÖ
   - Images (local storage) ‚úÖ
   - Owner information ‚úÖ
   - Availability toggle ‚úÖ

3. **Users Collection** - ‚úÖ Complete for MVP
   - Basic user information ‚úÖ
   - Role management ‚úÖ
   - Timestamps ‚úÖ

4. **Bookings Collection** - ‚úÖ Complete for MVP
   - Core booking details ‚úÖ
   - Status management ‚úÖ
   - Additional services ‚úÖ
   - References to properties and users ‚úÖ

### üìù Recommended Additions (Optional):

For a more robust platform, consider adding:

1. **Reviews Collection** (New)
   - Property reviews and ratings
   - Guest reviews by hosts

2. **Messages Collection** (New)
   - Communication between guests and hosts

3. **Payments Collection** (New)
   - Detailed payment records
   - Refund history

4. **Notifications Collection** (New)
   - User notifications
   - Email/SMS tracking

---

## Schema Validation Rules

All schemas include:

- ‚úÖ **Automatic Timestamps**: `createdAt` and `updatedAt` managed by Mongoose
- ‚úÖ **Type Validation**: All fields have type checking
- ‚úÖ **Required Fields**: Critical fields marked as required
- ‚úÖ **Default Values**: Sensible defaults where applicable
- ‚úÖ **Enums**: Restricted values for status fields
- ‚úÖ **References**: Proper ObjectId references with `ref`

---

## Database Indexes

Recommended indexes for performance:

```javascript
// Rentals
db.rentals.createIndex({ location: 1 })
db.rentals.createIndex({ availability: 1 })
db.rentals.createIndex({ price: 1 })

// Users
db.users.createIndex({ email: 1 }, { unique: true })
db.users.createIndex({ role: 1 })

// Bookings
db.bookings.createIndex({ propertyId: 1 })
db.bookings.createIndex({ userId: 1 })
db.bookings.createIndex({ status: 1 })
db.bookings.createIndex({ checkIn: 1, checkOut: 1 })

// Admins
db.admins.createIndex({ email: 1 }, { unique: true })
```

---

## Conclusion

‚úÖ **Your current schema is complete for MVP functionality!**

All essential fields are present for:
- Admin authentication
- Property management
- User management
- Booking management

The optional fields listed above can be added later as your platform grows and requires more features.

---

## Next Steps

1. ‚úÖ Test MongoDB connection
2. ‚úÖ Create sample data for testing
3. ‚úÖ Run the admin console
4. ‚úÖ Test all CRUD operations

For questions or to add any of the optional fields, refer to the models in:
- `admin-console/models/Admin.js`
- `admin-console/models/Rental.js`
- `admin-console/models/User.js`
- `admin-console/models/Booking.js`

