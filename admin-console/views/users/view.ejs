<%- include('../partials/header') %>

<% if (error && error.length > 0) { %>
  <div class="alert alert-danger alert-dismissible fade show" role="alert">
    <%= error[0] %>
    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
  </div>
<% } %>

<% if (success && success.length > 0) { %>
  <div class="alert alert-success alert-dismissible fade show" role="alert">
    <%= success[0] %>
    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
  </div>
<% } %>

<div class="row mb-4">
  <div class="col">
    <h1 class="h3 mb-0">
      <i class="bi bi-person-circle"></i> User Details
    </h1>
    <p class="text-muted">View user information and booking history</p>
  </div>
  <div class="col-auto">
    <a href="/users" class="btn btn-outline-secondary">
      <i class="bi bi-arrow-left"></i> Back to Users
    </a>
  </div>
</div>

<div class="row">
  <div class="col-lg-4 mb-4">
    <div class="card border-0 shadow-sm">
      <div class="card-header bg-white">
        <h5 class="mb-0">User Information</h5>
      </div>
      <div class="card-body">
        <div class="mb-3">
          <small class="text-muted d-block">Name</small>
          <strong><%= user.displayName || 'N/A' %></strong>
        </div>
        
        <div class="mb-3">
          <small class="text-muted d-block">Email</small>
          <strong><%= user.email %></strong>
        </div>
        
        <div class="mb-3">
          <small class="text-muted d-block">Phone</small>
          <strong><%= user.phoneNumber || 'N/A' %></strong>
        </div>
        
        <div class="mb-3">
          <small class="text-muted d-block">Role</small>
          <% if (user.role === 'admin') { %>
            <span class="badge bg-danger">Admin</span>
          <% } else if (user.role === 'owner') { %>
            <span class="badge bg-warning">Owner</span>
          <% } else { %>
            <span class="badge bg-secondary">User</span>
          <% } %>
        </div>
        
        <div class="mb-3">
          <small class="text-muted d-block">Registered</small>
          <strong>
            <% if (user.createdAt) { %>
              <%= user.createdAt.toLocaleDateString() %>
            <% } else { %>
              N/A
            <% } %>
          </strong>
        </div>

        <div class="mb-3">
          <small class="text-muted d-block">User ID</small>
          <small class="font-monospace"><%= user._id %></small>
        </div>

        <% if (user.role !== 'admin') { %>
          <hr>
          <form action="/users/<%= user._id %>/delete" method="POST">
            <button type="submit" class="btn btn-danger w-100 delete-confirm">
              <i class="bi bi-trash"></i> Delete User
            </button>
          </form>
        <% } %>
      </div>
    </div>
  </div>

  <div class="col-lg-8">
    <div class="card border-0 shadow-sm">
      <div class="card-header bg-white">
        <h5 class="mb-0">
          <i class="bi bi-calendar-check"></i> Booking History
          <span class="badge bg-primary ms-2"><%= bookings.length %></span>
        </h5>
      </div>
      <div class="card-body p-0">
        <% if (bookings.length > 0) { %>
          <div class="table-responsive">
            <table class="table table-hover mb-0">
              <thead class="table-light">
                <tr>
                  <th>Booking ID</th>
                  <th>Property</th>
                  <th>Check In</th>
                  <th>Check Out</th>
                  <th>Status</th>
                  <th>Total</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <% bookings.forEach(booking => { %>
                  <tr>
                    <td><small class="font-monospace"><%= booking._id.toString().substring(0, 8) %>...</small></td>
                    <td><%= booking.propertyTitle %></td>
                    <td><%= booking.checkIn.toLocaleDateString() %></td>
                    <td><%= booking.checkOut.toLocaleDateString() %></td>
                    <td>
                      <% if (booking.status === 'pending') { %>
                        <span class="badge bg-warning">Pending</span>
                      <% } else if (booking.status === 'confirmed') { %>
                        <span class="badge bg-success">Confirmed</span>
                      <% } else if (booking.status === 'cancelled') { %>
                        <span class="badge bg-danger">Cancelled</span>
                      <% } %>
                    </td>
                    <td>$<%= booking.totalPrice.toLocaleString() %></td>
                    <td>
                      <a href="/bookings/<%= booking._id %>" class="btn btn-sm btn-outline-primary">
                        <i class="bi bi-eye"></i>
                      </a>
                    </td>
                  </tr>
                <% }) %>
              </tbody>
            </table>
          </div>
        <% } else { %>
          <div class="text-center py-5 text-muted">
            <i class="bi bi-calendar-x fs-1 d-block mb-3"></i>
            <p>No bookings yet</p>
          </div>
        <% } %>
      </div>
    </div>
  </div>
</div>

<%- include('../partials/footer') %>

